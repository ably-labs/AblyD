<!DOCTYPE html>
<script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
<h1>AblyD Example</h1>

<div class="row">
  <p>This demo will make a request through Ably to our server, telling it to publish output from its current script to the namespace 'test'. This page is then subscribed to outputs from the server to Ably to the 'test:serveroutput' channel.</p>
  <p>Make sure to replace the 'INSERT_API_KEY_HERE' in the JavaScript with your Ably API key!</p>
  <button onclick="publish()">Publish the command to the server to run the script</button>
</div>

<pre id="log"></pre>
<script>
  // helper function: log message to screen
  function log(msg) {
    document.getElementById('log').textContent += msg + '\n';
  }
  // Messages from the server will come as ArrayBuffers, so need decoding
  let enc = new TextDecoder("utf-8");

  // The namespace we will ask the server to publish to
  let namespace = "test";

  let ably = new Ably.Realtime('INSERT_API_KEY_HERE');
  let commandChannel = ably.channels.get("command");
  let testChannel = ably.channels.get(namespace + ":serveroutput");


  testChannel.subscribe((msg) => {
  	log(enc.decode(msg.data));
  });

  function publish() {
    // Tells the server to publish to the namespace 'test'
    commandChannel.publish("start", namespace);
  }
</script>
